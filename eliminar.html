<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Artistas y Canciones Firebase</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Montserrat', sans-serif;
      background: linear-gradient(135deg, #121212 0%, #1e1e1e 100%);
      color: #eee;
      min-height: 100vh;
      padding: 2rem;
    }
    h1 {
      font-weight: 700;
      font-size: 2.25rem;
      color: #a0f0a0;
      text-align: center;
      margin-bottom: 2rem;
      user-select: none;
    }
    /* Scrollbar oculto */
    #artistList, #songList {
      max-width: 600px;
      margin: 0 auto 1.5rem auto;
      overflow-y: auto;
      max-height: 60vh;
    }
    #artistList::-webkit-scrollbar,
    #songList::-webkit-scrollbar {
      display: none;
    }
    button.artist-btn {
      width: 100%;
      text-align: left;
      padding: 0.75rem 1rem;
      background: #222;
      border-radius: 12px;
      font-weight: 600;
      font-size: 1.125rem;
      color: #a0f0a0;
      margin-bottom: 0.5rem;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button.artist-btn:hover {
      background-color: #4ade80;
      color: #000;
    }
    li.song-item {
      background: #222;
      border-radius: 12px;
      padding: 0.75rem 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
      box-shadow: 0 0 8px #000;
      transition: box-shadow 0.3s ease;
    }
    li.song-item:hover {
      box-shadow: 0 0 15px #4ade80;
    }
    .song-info {
      max-width: 80%;
      overflow: hidden;
    }
    .song-title {
      font-weight: 700;
      font-size: 1.1rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .song-artist {
      color: #aaa;
      font-size: 0.9rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    button.delete-btn {
      background: transparent;
      border: none;
      cursor: pointer;
      color: #f87171; 
      transition: color 0.3s ease;
      padding: 0;
    }
    button.delete-btn:hover {
      color: #b91c1c;
    }

* {
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
  </style>
</head>
<body>
  <h1>Artistas y Canciones</h1>
  <div id="artistList"></div>
  <ul id="songList"></ul>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
    import { getDatabase, ref, onValue, remove } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDiACaIKPXiSdcBo-bq4BW7z7gjpouVNos",
      authDomain: "flixplemusic.firebaseapp.com",
      databaseURL: "https://flixplemusic-default-rtdb.firebaseio.com",
      projectId: "flixplemusic",
      storageBucket: "flixplemusic.firebasestorage.app",
      messagingSenderId: "792301053512",
      appId: "1:792301053512:web:13878703d081f1a7b3da7d"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const tracksRef = ref(db, "tracks");

    const artistListDiv = document.getElementById("artistList");
    const songListUl = document.getElementById("songList");

    let allTracks = {};
    let currentArtist = null;

    // Función para eliminar canción en Firebase
    function eliminarCancion(id) {
      if(confirm("¿Eliminar esta canción? Esta acción no se puede deshacer.")) {
        const trackRef = ref(db, `tracks/${id}`);
        remove(trackRef).catch(err => alert("Error al eliminar: " + err));
      }
    }

    // Mostrar lista de artistas únicos
    function mostrarArtistas() {
      artistListDiv.innerHTML = "";
      songListUl.innerHTML = "";
      currentArtist = null;

      if (!allTracks || Object.keys(allTracks).length === 0) {
        artistListDiv.innerHTML = '<p class="text-center text-gray-400 select-none">No hay artistas disponibles</p>';
        return;
      }

      // Extraer artistas únicos
      const artistasUnicos = new Map();
      for (const [id, track] of Object.entries(allTracks)) {
        if(track.artist) {
          artistasUnicos.set(track.artist, true);
        }
      }

      if (artistasUnicos.size === 0) {
        artistListDiv.innerHTML = '<p class="text-center text-gray-400 select-none">No hay artistas disponibles</p>';
        return;
      }

      artistasUnicos.forEach((_, artista) => {
        const btn = document.createElement("button");
        btn.className = "artist-btn";
        btn.textContent = artista;
        btn.onclick = () => mostrarCancionesArtista(artista);
        artistListDiv.appendChild(btn);
      });
    }

    // Mostrar canciones del artista seleccionado
    function mostrarCancionesArtista(artista) {
      currentArtist = artista;
      songListUl.innerHTML = "";
      artistListDiv.innerHTML = ""; // Ocultar lista de artistas

      // Botón para volver a la lista de artistas
      const backBtn = document.createElement("button");
      backBtn.textContent = "← Volver a artistas";
      backBtn.className = "artist-btn mb-6";
      backBtn.onclick = () => mostrarArtistas();
      artistListDiv.appendChild(backBtn);

      // Mostrar solo el botón de volver y canciones del artista
      document.body.insertBefore(artistListDiv, songListUl);

      // Filtrar canciones del artista
      const canciones = Object.entries(allTracks).filter(([id, track]) => track.artist === artista);

      if (canciones.length === 0) {
        songListUl.innerHTML = '<li class="text-center text-gray-400 select-none">No hay canciones para este artista.</li>';
        return;
      }

      canciones.forEach(([id, track]) => {
        const li = document.createElement("li");
        li.className = "song-item";

        const infoDiv = document.createElement("div");
        infoDiv.className = "song-info";

        const titleSpan = document.createElement("span");
        titleSpan.className = "song-title";
        titleSpan.textContent = track.title || "Sin título";

        const artistSpan = document.createElement("span");
        artistSpan.className = "song-artist";
        artistSpan.textContent = track.artist || "Artista desconocido";

        infoDiv.appendChild(titleSpan);
        infoDiv.appendChild(artistSpan);

        li.appendChild(infoDiv);

        // Botón eliminar
        const deleteBtn = document.createElement("button");
        deleteBtn.className = "delete-btn";
        deleteBtn.title = "Eliminar canción";
        deleteBtn.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2"
            viewBox="0 0 24 24" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        `;
        deleteBtn.onclick = () => eliminarCancion(id);

        li.appendChild(deleteBtn);

        songListUl.appendChild(li);
      });
    }

    onValue(tracksRef, (snapshot) => {
      allTracks = snapshot.val() || {};
      if(currentArtist) {
        // Si hay artista seleccionado, refrescar lista canciones
        mostrarCancionesArtista(currentArtist);
      } else {
        mostrarArtistas();
      }
    }, (error) => {
      artistListDiv.innerHTML = '<p class="text-center text-red-500 select-none">Error cargando datos</p>';
      songListUl.innerHTML = "";
      console.error("Error leyendo datos:", error);
    });
     // Bloquear clic derecho
  document.addEventListener('contextmenu', function (e) {
    e.preventDefault();
  });

  // Bloquear teclas F12, Ctrl+Shift+I, Ctrl+U, Ctrl+Shift+J, Ctrl+S, Ctrl+P
  document.addEventListener('keydown', function (e) {
    if (
      e.key === 'F12' ||
      (e.ctrlKey && e.shiftKey && ['I', 'J', 'C'].includes(e.key.toUpperCase())) ||
      (e.ctrlKey && ['U', 'S', 'P'].includes(e.key.toUpperCase()))
    ) {
      e.preventDefault();
    }
  });

  // Bloquear menú desde click derecho largo (por si algún navegador no lo previene)
  window.oncontextmenu = function () {
    return false;
  };


  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('a').forEach(el => {
      const url = el.getAttribute('href');
      el.removeAttribute('href');
      el.style.cursor = 'pointer';
      el.onclick = () => window.location.href = url;
    });
  });
  </script>
</body>
</html>

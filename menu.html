<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Menú Inferior con Perfil Slider</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<style>
  body {
    margin: 0;
    background-color: #000;
    color: white;
    font-family: sans-serif;
    overflow-x: hidden;
  }
  nav {
    position: fixed;
    bottom: 0; left: 0; right: 0;
    background-color: #000;
    border-top: 2px solid #90ee90; /* verde claro */
    display: flex;
    justify-content: space-around;
    padding: 0.5rem 0;
    font-size: 10px;
    z-index: 10001; /* superior al slider */
  }
  nav button {
    background: none;
    border: none;
    color: inherit;
    display: flex;
    flex-direction: column;
    align-items: center;
    cursor: pointer;
  }
  nav button:hover {
    opacity: 0.8;
  }
  #avatar {
    width: 32px; height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 14px;
    user-select: none;
    color: white;
    border: 2px solid #90ee90; /* borde verde claro */
    overflow: hidden;
  }
  .active-tab i,
  .active-tab span {
    color: #a855f7 !important;
    stroke: #a855f7 !important;
  }

  /* Contenedor para perfil con slide, sin ocultar menú */
  #profile-container {
    position: fixed;
    top: 0;
    right: 0;
    width: 100%;
    max-width: 360px;
    height: calc(100vh - 48px); /* menos altura del menú inferior */
    background-color: #f5f6f7;
    color: black;
    font-family: sans-serif;
    padding: 1rem;
    box-sizing: border-box;
    overflow-y: auto;
    z-index: 10000;
    transform: translateX(100%);
    transition: transform 0.4s ease;
    border-left: 1px solid #ddd;
    /* Posición encima pero sin tapar menú inferior */
    bottom: 48px; /* alto menú inferior para que no lo cubra */
  }
  #profile-container.visible {
    transform: translateX(0);
  }

  /* Animación slide-in para contenido del perfil */
  @keyframes slideInRight {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }
  #profile-content {
    animation: slideInRight 0.4s ease-out forwards;
  }

  /* Estilos internos del perfil */
  #contenedor-perfil {
    background: white;
    padding: 1rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    border-radius: 0.5rem;
    box-shadow: 0 0 10px rgba(0,0,0,0.2);
  }
  #contenedor-perfil #avatar-profile {
    width: 64px; height: 64px;
    background: #888;
    color: white;
    font-size: 2rem;
    font-weight: bold;
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 50%;
    overflow: hidden;
  }
  #user-name {
    font-weight: 600;
    font-size: 1.2rem;
    color: #333;
  }
  #seccion-mi-informacion {
    background: white;
    padding: 1rem;
    margin-top: 1rem;
    border-radius: 0.5rem;
    box-shadow: 0 0 10px rgba(0,0,0,0.2);
    max-width: 400px;
    position: relative;
    display: none;
    color: black;
  }
  #seccion-mi-informacion.visible {
    display: block;
  }
  #btn-cerrar-mi-informacion {
    background: none;
    border: none;
    cursor: pointer;
  }
  #opciones-container {
    background: white;
    margin-top: 1rem;
    padding: 1rem;
    border-radius: 0.5rem;
    box-shadow: 0 0 10px rgba(0,0,0,0.2);
    max-width: 500px;
    color: black;
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
  }
  #opciones-container button,
  #opciones-container a {
    background: #f0f0f0;
    padding: 0.75rem;
    border-radius: 0.5rem;
    text-decoration: none;
    color: #2563eb;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
  }
  #opciones-container button:hover,
  #opciones-container a:hover {
    background: #dbeafe;
  }
</style>
</head>
<body>

<!-- Menú Inferior -->
<nav>
  <button aria-label="Inicio" onclick="goToPage('https://nimeapp.github.io/Flixplemusic/index.html', this)">
    <i data-lucide="home" class="text-purple-500"></i>
    <span>Inicio</span>
  </button>

  <button aria-label="Buscar" onclick="goToPage('https://nimeapp.github.io/Flixplemusic/buscador.html', this)">
    <i data-lucide="search" class="text-purple-500"></i>
    <span>Buscar</span>
  </button>

  <button aria-label="Tu Lista" onclick="goToPage('https://nimeapp.github.io/Flixplemusic/tulista.html', this)">
    <i data-lucide="list" class="text-purple-500"></i>
    <span>Tu Lista</span>
  </button>

  <button id="profile-btn" aria-label="Perfil" style="padding:0;">
    <div id="avatar"></div>
  </button>
</nav>

<!-- Contenedor Perfil (oculto inicialmente, se muestra con slide) -->
<div id="profile-container" aria-label="Perfil de Usuario" role="dialog" aria-modal="true" aria-hidden="true" tabindex="-1">
  <div id="profile-content">

    <div id="contenedor-perfil">
      <div id="avatar-profile" class="w-16 h-16 rounded-full bg-gray-300 flex items-center justify-center text-xl font-bold text-white"></div>
      <div>
        <span id="user-name"></span>
      </div>
    </div>

    <div id="seccion-mi-informacion">
      <h2 class="text-xl font-semibold mb-4 flex justify-between items-center">
        Mi Información
        <button id="btn-cerrar-mi-informacion" title="Cerrar información" aria-label="Cerrar información">
          <i data-lucide="x" class="w-6 h-6"></i>
        </button>
      </h2>
      <p><strong>Nombre:</strong> <span id="info-nombre"></span></p>
      <p><strong>Correo:</strong> <span id="info-correo"></span></p>
      <button id="btn-cambiar-contrasena" class="mt-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md">Cambiar contraseña</button>
    </div>

    <div id="opciones-container">
      <button id="btn-mi-informacion" type="button" class="flex items-center gap-3 p-3 bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none">
        <i data-lucide="user" class="w-6 h-6 text-blue-500"></i>
        <span>Mi información</span>
      </button>

      <button id="btn-feeds" type="button" class="flex items-center gap-3 p-3 bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none">
        <i data-lucide="newspaper" class="w-6 h-6 text-blue-500"></i>
        <span>Feeds</span>
      </button>

      <a href="go:politicas-privacidad" class="flex items-center gap-3 p-3 bg-gray-100 rounded-lg hover:bg-gray-200">
        <i data-lucide="shield-check" class="w-6 h-6 text-blue-500"></i>
        <span>Políticas y Privacidad</span>
      </a>

      <a href="go:politica-uso" class="flex items-center gap-3 p-3 bg-gray-100 rounded-lg hover:bg-gray-200">
        <i data-lucide="file-text" class="w-6 h-6 text-blue-500"></i>
        <span>Política de Uso</span>
      </a>

      <a href="go:cookies" class="flex items-center gap-3 p-3 bg-gray-100 rounded-lg hover:bg-gray-200">
        <i data-lucide="cookie" class="w-6 h-6 text-blue-500"></i>
        <span>Cookies</span>
      </a>

      <a href="go:ayuda" class="flex items-center gap-3 p-3 bg-gray-100 rounded-lg hover:bg-gray-200">
        <i data-lucide="help-circle" class="w-6 h-6 text-blue-500"></i>
        <span>Ayuda</span>
      </a>

      <a href="go:contacto" class="flex items-center gap-3 p-3 bg-gray-100 rounded-lg hover:bg-gray-200">
        <i data-lucide="mail" class="w-6 h-6 text-blue-500"></i>
        <span>Contacto</span>
      </a>

      <a href="go:acerca" class="flex items-center gap-3 p-3 bg-gray-100 rounded-lg hover:bg-gray-200">
        <i data-lucide="info" class="w-6 h-6 text-blue-500"></i>
        <span>Acerca de</span>
      </a>

      <a href="go:compartir" class="flex items-center gap-3 p-3 bg-gray-100 rounded-lg hover:bg-gray-200">
        <i data-lucide="share-2" class="w-6 h-6 text-blue-500"></i>
        <span>Compartir la app</span>
      </a>

      <a href="go:sugerencias" class="flex items-center gap-3 p-3 bg-gray-100 rounded-lg hover:bg-gray-200">
        <i data-lucide="message-circle" class="w-6 h-6 text-blue-500"></i>
        <span>Enviar sugerencias</span>
      </a>
    </div>

  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
  import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDiACaIKPXiSdcBo-bq4BW7z7gjpouVNos",
    authDomain: "flixplemusic.firebaseapp.com",
    databaseURL: "https://flixplemusic-default-rtdb.firebaseio.com",
    projectId: "flixplemusic",
    storageBucket: "flixplemusic.firebasestorage.app",
    messagingSenderId: "792301053512",
    appId: "1:792301053512:web:13878703d081f1a7b3da7d"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);

  const avatarDiv = document.getElementById('avatar');
  const avatarProfile = document.getElementById('avatar-profile');
  const userNameSpan = document.getElementById('user-name');

  const profileContainer = document.getElementById('profile-container');

  const btnMiInfo = document.getElementById('btn-mi-informacion');
  const seccionMiInfo = document.getElementById('seccion-mi-informacion');
  const btnCerrarMiInfo = document.getElementById('btn-cerrar-mi-informacion');

  const infoNombre = document.getElementById('info-nombre');
  const infoCorreo = document.getElementById('info-correo');
  const btnCambiarContrasena = document.getElementById('btn-cambiar-contrasena');

  let usuarioActual = null;

  function setAvatar(initials, color, photoURL) {
    if (photoURL) {
      avatarDiv.innerHTML = `<img src="${photoURL}" alt="avatar" class="w-full h-full object-cover rounded-full">`;
      avatarDiv.style.backgroundColor = '';
      avatarDiv.textContent = '';
      avatarProfile.innerHTML = avatarDiv.innerHTML;
      avatarProfile.style.backgroundColor = '';
      avatarProfile.textContent = '';
    } else {
      avatarDiv.textContent = initials || '';
      avatarDiv.style.backgroundColor = color || '#555';
      avatarProfile.textContent = initials || '';
      avatarProfile.style.backgroundColor = color || '#555';
    }
  }

  onAuthStateChanged(auth, async (user) => {
    if (user) {
      try {
        const userRef = ref(db, 'users/' + user.uid);
        const snapshot = await get(userRef);
        if (snapshot.exists()) {
          const data = snapshot.val();
          usuarioActual = { ...data, email: data.email || user.email, displayName: data.name || user.displayName };
          userNameSpan.textContent = data.name || user.displayName || '';
          setAvatar(data.initials || (data.name ? data.name.charAt(0).toUpperCase() : ''), data.profileColor || '#555', data.photoURL || user.photoURL);
        } else {
          usuarioActual = { displayName: user.displayName, email: user.email, photoURL: user.photoURL };
          userNameSpan.textContent = user.displayName || '';
          setAvatar('', '#555', user.photoURL);
        }
      } catch (e) {
        console.error('Error leyendo usuario:', e);
        usuarioActual = { displayName: user.displayName, email: user.email, photoURL: user.photoURL };
        userNameSpan.textContent = user.displayName || '';
        setAvatar('', '#555', user.photoURL);
      }
    } else {
      window.top.location.href = 'https://nimeapp.github.io/Flixplemusic/loginuser.html';
    }
    cerrarMiInformacion();
  });

  // Toggle slider perfil con botón perfil
  document.getElementById('profile-btn').addEventListener('click', () => {
    const isVisible = profileContainer.classList.contains('visible');
    if (isVisible) {
      profileContainer.classList.remove('visible');
      profileContainer.setAttribute('aria-hidden', 'true');
      cerrarMiInformacion();
    } else {
      profileContainer.classList.add('visible');
      profileContainer.setAttribute('aria-hidden', 'false');
    }
  });

  function abrirMiInformacion() {
    if (!usuarioActual) return;
    seccionMiInfo.classList.add('visible');
    seccionMiInfo.classList.remove('hidden');
    infoNombre.textContent = usuarioActual.name || usuarioActual.displayName || 'Sin nombre';
    infoCorreo.textContent = usuarioActual.email || 'Sin correo';
  }
  function cerrarMiInformacion() {
    seccionMiInfo.classList.remove('visible');
    seccionMiInfo.classList.add('hidden');
  }

  btnMiInfo.addEventListener('click', abrirMiInformacion);
  btnCerrarMiInfo.addEventListener('click', cerrarMiInformacion);

  btnCambiarContrasena.addEventListener('click', e => {
    e.stopPropagation();
    window.top.location.href = 'https://nimeapp.github.io/Flixplemusic/reset_password.html';
  });

  // Navegación simple
  function goToPage(url, btn) {
    document.querySelectorAll('nav button').forEach(b => b.classList.remove('active-tab'));
    btn.classList.add('active-tab');
    window.location.href = url;
  }
</script>

<script>
  lucide.createIcons();
</script>

</body>
</html>

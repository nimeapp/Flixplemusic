<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Panel Administrador</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    /* Icono cámara centrado dentro del círculo */
    #camera-icon { width:28px; height:28px; display:flex; align-items:center; justify-content:center; padding:4px; }
    #camera-icon i { width:14px !important; height:14px !important; }

    /* Sidebar perfil */
    #profile-sidebar { transition: transform 0.3s ease-in-out; transform: translateX(100%); display:flex; flex-direction:column; justify-content:space-between; }
    #profile-sidebar.open { transform: translateX(0); }
    #sidebar-overlay { transition: opacity 0.3s ease-in-out; opacity:0; pointer-events:none; background:rgba(0,0,0,0.7); position:fixed; inset:0; z-index:30; }
    #sidebar-overlay.visible { opacity:1; pointer-events:auto; }

    /* Modal */
    #modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.7); display:none; justify-content:center; align-items:center; z-index:50; }
    #modal-overlay.active { display:flex; }
    #modal { background:#1f2937; border-radius:0.5rem; padding:1.5rem; width:90%; max-width:400px; box-shadow:0 10px 15px rgba(0,0,0,0.5); color:#e0e0e0; }
    #modal h3 { font-size:1.25rem; margin-bottom:1rem; }
    #modal input[type="url"] { width:100%; padding:0.5rem; border-radius:0.375rem; border:none; margin-bottom:1rem; font-size:1rem; color:#111827; }
    #modal button { background-color:#7c3aed; color:white; padding:0.5rem 1rem; border-radius:0.375rem; font-weight:600; cursor:pointer; transition:background-color 0.2s; margin-right:0.5rem; }
    #modal button:hover { background-color:#6d28d9; }
    #modal .btn-cancel { background-color:#374151; }
    #modal .btn-cancel:hover { background-color:#4b5563; }
    #modal p.error { color:#f87171; margin-top:0.5rem; font-size:0.875rem; }

    /* TARJETAS DASHBOARD */
    .dashboard-card { background:#1f2937; border-radius:0.75rem; padding:1.5rem; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:0.75rem; transition: transform 0.3s, box-shadow 0.3s, background 0.3s; cursor:pointer; border:1px solid #374151; }
    .dashboard-card:hover { transform:translateY(-4px); box-shadow:0 10px 20px rgba(0,0,0,0.5); background:#27272a; }
    .dashboard-card i { width:48px; height:48px; color:#a78bfa; }
    .dashboard-card span { font-size:1rem; font-weight:600; text-align:center; color:#e0e0e0; }
  </style>
</head>
<body class="bg-gray-900 text-gray-200 min-h-screen flex flex-col">

  <!-- HEADER -->
  <header class="bg-gray-800 p-4 flex items-center justify-between relative z-20">
    <div class="relative cursor-pointer" id="profile-container" title="Ver perfil">
      <img id="profile-image"
        src="https://via.placeholder.com/150?text=Sin+Imagen"
        alt="Perfil"
        class="rounded-full w-16 h-16 object-cover border-4 border-purple-400" />
      <div id="camera-icon" class="absolute bg-gray-500 rounded-full shadow-lg opacity-80 cursor-pointer border-2 border-white"
        style="bottom: 0; right: 0;" title="Editar imagen">
        <i data-lucide="camera" class="text-white"></i>
      </div>
    </div>
  </header>

  <!-- CONTENIDO PRINCIPAL -->
  <main class="flex-grow p-6 max-w-4xl mx-auto w-full">
    <section class="grid grid-cols-2 gap-6">
      <a href="https://nimeapp.github.io/Flixplemusic/editar.html" class="dashboard-card" title="Editar Perfil">
        <i data-lucide="edit-2"></i>
        <span>Editar Perfil</span>
      </a>

      <a href="https://nimeapp.github.io/Flixplemusic/generadorMusica.html" class="dashboard-card" title="Generador Música">
        <i data-lucide="music"></i>
        <span>Generador Música</span>
      </a>

      <a href="https://nimeapp.github.io/Flixplemusic/generadorfeed.html" class="dashboard-card" title="Generador Feed">
        <i data-lucide="rss"></i>
        <span>Generador Feed</span>
      </a>

      <a href="https://nimeapp.github.io/Flixplemusic/eliminar.html" class="dashboard-card" title="Eliminar Canciones">
        <i data-lucide="trash-2"></i>
        <span>Eliminar Canciones</span>
      </a>
    </section>
  </main>

  <!-- SIDEBAR -->
  <div id="sidebar-overlay"></div>
  <aside id="profile-sidebar" class="fixed top-0 right-0 h-full w-80 bg-gray-800 shadow-lg p-6 flex flex-col z-40">
    <div>
      <button id="close-sidebar-btn" class="self-end text-purple-400 hover:text-purple-600 mb-6" title="Cerrar perfil">
        <i data-lucide="x" class="w-6 h-6 cursor-pointer"></i>
      </button>
      <img id="sidebar-profile-image" alt="Perfil" class="mx-auto rounded-full w-28 h-28 object-cover border-4 border-purple-400 mb-6" />
      <h2 id="sidebar-user-name" class="text-2xl font-semibold mb-1 flex items-center justify-center gap-2">
        <i data-lucide="user" class="w-6 h-6"></i>
        <span>Nombre</span>
      </h2>
      <p id="sidebar-user-email" class="text-purple-400 mb-6 flex items-center justify-center gap-2">
        <i data-lucide="mail" class="w-5 h-5"></i>
        <span>Email</span>
      </p>
      <p class="text-purple-300 mb-6 font-medium text-center">Administrador</p>
    </div>
    <button id="logout-btn" class="bg-purple-600 hover:bg-purple-700 px-5 py-3 rounded font-semibold inline-flex items-center justify-center gap-2 transition mt-auto w-full">
      <i data-lucide="log-out" class="w-5 h-5"></i>
      Cerrar sesión
    </button>
  </aside>

  <!-- MODAL -->
  <div id="modal-overlay">
    <div id="modal">
      <h3>Cambiar URL de imagen de perfil</h3>
      <input type="url" id="new-image-url" placeholder="Pega aquí la URL de la imagen" />
      <p id="modal-error" class="error hidden"></p>
      <div class="flex justify-end">
        <button class="btn-cancel" id="modal-cancel-btn">Cancelar</button>
        <button id="modal-save-btn">Guardar</button>
      </div>
    </div>
  </div>

  <p id="error-msg" class="text-red-500 mt-4 text-center"></p>

  <script type="module">
    lucide.createIcons();

    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
    import { getDatabase, ref, get, update } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDiACaIKPXiSdcBo-bq4BW7z7gjpouVNos",
      authDomain: "flixplemusic.firebaseapp.com",
      databaseURL: "https://flixplemusic-default-rtdb.firebaseio.com",
      projectId: "flixplemusic",
      storageBucket: "flixplemusic.firebasestorage.app",
      messagingSenderId: "798157423410",
      appId: "1:798157423410:web:fa4bb34d108c62a8626df2"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const database = getDatabase(app);

    // Verificar si el usuario está autenticado
    onAuthStateChanged(auth, (user) => {
      if (user) {
        const uid = user.uid;
        const userRef = ref(database, 'Usuarios/' + uid);
        get(userRef).then((snapshot) => {
          if (snapshot.exists()) {
            const data = snapshot.val();
            // Actualizar datos en header y sidebar
            document.getElementById('profile-image').src = data.foto || "https://via.placeholder.com/150?text=Sin+Imagen";
            document.getElementById('sidebar-profile-image').src = data.foto || "https://via.placeholder.com/150?text=Sin+Imagen";
            document.getElementById('sidebar-user-name').querySelector('span').innerText = data.nombre || "Usuario";
            document.getElementById('sidebar-user-email').querySelector('span').innerText = data.email || "email@ejemplo.com";
          }
        }).catch(err => console.error(err));
      } else {
        // Redirigir si no está logueado
        window.location.href = "/login.html";
      }
    });

    // Cerrar sesión
    document.getElementById('logout-btn').addEventListener('click', () => {
      signOut(auth).then(() => window.location.href = "/login.html");
    });

    // Modal cambiar imagen
    const modalOverlay = document.getElementById('modal-overlay');
    const profileImage = document.getElementById('profile-image');
    const cameraIcon = document.getElementById('camera-icon');
    const modalSaveBtn = document.getElementById('modal-save-btn');
    const modalCancelBtn = document.getElementById('modal-cancel-btn');
    const newImageUrl = document.getElementById('new-image-url');
    const modalError = document.getElementById('modal-error');

    cameraIcon.addEventListener('click', () => modalOverlay.classList.add('active'));
    modalCancelBtn.addEventListener('click', () => modalOverlay.classList.remove('active'));
    
    modalSaveBtn.addEventListener('click', () => {
      const url = newImageUrl.value.trim();
      if (!url) { modalError.innerText="La URL no puede estar vacía"; modalError.classList.remove('hidden'); return; }
      const uid = auth.currentUser.uid;
      const updates = {}; updates['Usuarios/' + uid + '/foto'] = url;
      update(ref(database), updates).then(() => {
        profileImage.src = url;
        document.getElementById('sidebar-profile-image').src = url;
        modalOverlay.classList.remove('active');
      }).catch(err => { modalError.innerText = err.message; modalError.classList.remove('hidden'); });
    });

  </script>
</body>
</html>
